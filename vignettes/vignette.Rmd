---
title: "Introduction to specieshindex"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, include=FALSE}
devtools::load_all(".")
```

```{r, include=FALSE}
library(specieshindex)
library(secret)
vault <- file.path("C:/Users/iamje/Jess/UNSW/Honours/Honours", ".vault")
key_dir <- file.path(system.file(package = "secret"), "user_keys")
public_key <- file.path(key_dir, "jesst.pub")
private_key <- file.path(key_dir, "jesst.pem")
myAPI <- get_secret("myAPI", key = private_key, vault = vault) #loading my hidden API key
```

There are many ways to guage research influence. We can simply sum up the number of publications and citations, which is a straight forward way without the need of any complicated mathematical formulae. On the other hand, there are more scientific ways of measurements using statistical indices. Some examples include the h-index, m-index, i10 index, h5 index , etc.

H-index is one of the main methods to measure publication influence objectively. It is calculated using the formula ($h = total~publications~(n)~that~have~EACH~been~cited~(n)~times$), after sorting the publications by their citation counts in a descending order. 

Currently, it is only used for authors and institutions to access their influence and productivity. With this package, we can create a similar profile for different living organisms that would show their citation metrics, including total publications, total citations, h-index, etc.

Here, I have created a package to compute species h-index and other indices, to enable comparisons of the productivity of research on different species.

## Workflow

Working with large datasets can be tedious. Having a plan before doing any analysis will help smoothing the process and relieving the stress. To get from data collection to making nice plots, you can follow these suggested steps:

1. Connect to Scopus and download citation data
2. Compute various indices

### Connecting to Scopus

Before initiating the retrieval of any data, make sure you have registered an API key from Scopus. Otherwise the functions will not run (and is in fact illegal). You can register your key [here](https://dev.elsevier.com/).

It is recommend that you run a quick search using `CountSpT()` or `CountSpTAK()` before actually fetching the records. Both functions give a search count of the amount of records found on the Scopus database. 

In the following functions, the suffixes 'T' is for title and 'TAK' is for title, abstract and keywords. These terms are used to locate where you want your search terms to be found in. While 'T' only targets the publications with the binomial name in its title, 'TAK' targets those with the name in its title, abstract and keywords. Make sure you are using binomial names instead of common names.

```{r, eval=FALSE}
CountSpT("Bettongia", "penicillata", myAPI)
```

```{r, eval=FALSE}
CountSpTAK("Bettongia", "penicillata", myAPI)
```

`CountSpTAK()` yielded more results since it also looked for the binomial name in the abstract and keywords in addition to the title. Now that you know exactly how many publications there are for the search, you can proceed to fetch the data from Scopus.

As you will soon discover, some species have been studied more than the others and thus resulting in higher research output. Therefore, if there are more than a few thousand citation records found, it will take a considerably longer time to fetch them all unless you are using a computer with high processing power.

```{r, eval=FALSE}
FetchSpT("Bettongia", "penicillata", myAPI)
```

```{r, eval=FALSE}
FetchSpTAK("Bettongia", "penicillata", myAPI)
```

In larger datasets, duplicates may appear, although usually in low numbers. `FetchSpT()` and `FetchSpTAK()` will clean up the dataset by removing them if found. The first occurence of the record will be kept, which is normally the original record.

#### Possible errors

If the error `Bad Request (HTTP 400)` occurs in this step, try connecting to the internet via your institute's provider instead of the one at home. This error might be caused by some authorisation issues.

It is important to make sure you have spelt the genus and species name accurately when entering the function. If unsure, you can go to the [Encyclopedia of Life](https://eol.org/) for verification. This is where the above functions are linked to for checking via the package `Taxize`. If the desired species is not in the encyclopedia, it is possible that it has just been discovered and not officially listed yet.

### Simple counts

These functions do simple calculations with various parameters. Although they are not statistical figures, they could provide insights into how they affect the indices. 

`TotalPub()` sums up the total publications from the search.

```{r}
TotalPub(Woylie)
```

`TotalCite()` sums up the total citations of all the records from the search.

```{r}
TotalCite(Woylie)
```

`TotalJournals()` counts the number of unique journals that the species have appeared in.

```{r}
TotalJournals(Woylie)
```

`TotalArt()` counts the number of publications that are articles.

```{r}
TotalArt(Woylie)
```

`TotalRev()` counts the number of publications that are reviews.

```{r}
TotalRev(Woylie)
```

`ARRatio()` calculates the percentage ratio of the number of articles:reviews, and rounds the percentage to 4 significant figures.

```{r}
ARRatio(Woylie)
```

`YearsPublishing()` counts the number of years since the first publication of the species.

```{r}
YearsPublishing(Woylie)
```

### Statistical indices

Statistical indices can provide deeper insigts than the counts above. They measure the productivity of publications regarding various species in this case. They take other parameters into consideration, such as time, total citations, total publications, etc., to compute the index.

Use `SpHindex()` to compute the h-index. It which sorts the citation count in descending order and then counts the number of publications (n) that have EACH been cited at least n times.

```{r}
SpHindex(Woylie)
```

The h5 index computes the h-index for the past 5 years.

```{r}
SpH5(Woylie)
```

To subset the time with a specific lower limit, you can use `SpHAfterdate()`. Make sure the date parameter is in the exact format of yyyy-mm-dd. Inputting a different format or using slashes `/` or hyphens `-` will return an error.

```{r}
SpHAfterdate(Woylie, "2000-01-01")
```

The m-index can be calculated using `SpMindex()`, which first computes the h-index and then divides it by the number of years of activity ($h/years~publishing$).

```{r}
SpMindex(Woylie)
```

The i10 index can be calculated using `Spi10()`, which simply counts the publications that has 10 or more citations.

```{r}
Spi10(Woylie)
```

### Quick summary of the metrices

The `Allindices()` function conveniently returns a dataframe with most of the above indices. This allows for quick analyses and plotting. If multiple species are being compared against each other, `rbind()` can be used to stitch them together and create an expansive dataframe.

```{r}
Allindices(Woylie, genus = "Bettongia", species = "penicillata")
```

## Worked examples

To demonstrate how this could be helpful in the real world, I will be comparing the citations of 4 species of marsupials. 

```{r}
dim(Woylie)
dim(Quokka)
dim(Platypus)
dim(Koala)
```

As shown here, there were 113 records of the woylie, 242 records of the quokka, 321 records of the platypus, and 773 records of the koala. They all have a total of 20 variables. I have skipped the steps of fetching the data from Scopus since it had already been demonstrated above. The function I used for this step was `FetchSpTAK()`.

### Comparing indices

The function `Allindices()` is a quick way to get all of the indices at once. It adds another column `species` containing the genus and species names. This will be very convenient when making plots.

If you want to compare and analyse them against each other, you can use the function `rbind()` to combine each entry of species into a single dataframe. But first, you will need to assign them separately into their own individual records. 

```{r}
W <- Allindices(Woylie, genus = "Bettongia", species = "penicillata")
Q <- Allindices(Quokka, genus = "Setonix", species = "brachyurus")
P <- Allindices(Platypus, genus = "Ornithorhynchus", species = "anatinus")
K <- Allindices(Koala, genus = "Phascolarctos", species = "cinereus")

CombineSp <- rbind(W, Q, P, K) #combining the citation records
return(CombineSp)
```

After preparing the data, we are ready to make some plots. Using the package `ggplot2`, I have arranged the h-index and m-index index on the separate plots. When comparing the indices, it is important to remember that their scales may differ drastically. Therefore, putting the variables in the same plot may generate plots that do not make a lot of sense. Nonetheless, it is worth making such plots if you want to know what the results would be.

Let us first examine the h-index. I have also added the total citations for comparison, since citations is an important factor in accessing this index.

```{r, fig.height=6, fig.width=7, fig.align='center'}
library(ggplot2)

#h-index
ggplot(CombineSp, aes(x = species)) +
  geom_point(aes(y = h,
                 colour = "H-index"),
             size = 6) +
  labs(x = "Species",
       y = "Index Score",
       colour = "Index",
       title = "h-index") +
  scale_x_discrete(labels = c("Woylie", "Quokka", "Platypus", "Koala")) +
  scale_colour_manual(values = c("H-index" = "#3498DB")) +
  theme(plot.title = element_text(size = 24, face = "bold"),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 16),
        legend.position = "none")

#total citations
ggplot(CombineSp, aes(x = species)) +
geom_point(aes(y = citations,
               colour = "Citations"),
           size = 6) +
labs(x = "Species",
     y = "Total citations",
     colour = "Index",
     title = "Citations") +
scale_x_discrete(labels = c("Woylie", "Quokka", "Platypus", "Koala")) + 
scale_colour_manual(values = c("Citations"  = "#2874A6")) +
theme(plot.title = element_text(size = 24, face = "bold"),
      axis.title = element_text(size = 18),
      axis.text = element_text(size = 16),
      legend.position = "none") 
```

\
It seems like the h values are quite consistent with the number of citations, i.e. the more the citations, the higher the index score. Therefore, the woylie, with the lowest amount of citations has the lowest h score. On the other hand, the koala, with the highest amount of citations has the highest h score.

Let us now plot the m-index and see how it differs from the h-index. Recalling that m-index is calculated by dividing the h-index by the number of years of activity ($h/years~publishing$), let us have a closer inspection at both the m-index itself and the variable `years_publishing`.

```{r, fig.height=6, fig.width=7, fig.align='center'}
#m-index
ggplot(CombineSp, aes(x = species)) +
  geom_point(aes(y = m,
                 colour = "M-index"),
             size = 6) +
  labs(x = "Species",
       y = "Index Score",
       colour = "Index",
       title = "m-index") +
  scale_x_discrete(labels = c("Woylie", "Quokka", "Platypus", "Koala")) + 
  scale_colour_manual(values = c("M-index"  = "#E74C3C")) +
  theme(plot.title = element_text(size = 24, face = "bold"),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 16),
        legend.position = "none")

#years publishing
ggplot(CombineSp, aes(x = species)) +
  geom_point(aes(y = years_publishing,
                 colour = "Years publishing"),
             size = 6) +
  labs(x = "Species",
       y = "Total years",
       colour = "Index",
       title = "Years publishing") +
  scale_x_discrete(labels = c("Woylie", "Quokka", "Platypus", "Koala")) + 
  scale_colour_manual(values = c("Years publishing" = "#17A589")) +
  theme(plot.title = element_text(size = 24, face = "bold"),
        axis.title = element_text(size = 18),
        axis.text = element_text(size = 16),
        legend.position = "none") 
```

\
In order to understand what yields a high m-index score, we can consider the index as a ratio. The combination of a higher `h` value and a lower `years_publishing` value is how a high m-index can be achieved. This explains why koala publications have a much lower score albeit its highest h-index. Its years in activity is more than 3 times that of the woylie. Although the h-index of woylie publications was half of that of the koala, it had only been in the scientific scene for a few decades. Comparing the quokka to the platypus, we can see that their publications have both been around for a similar duration of time. Since the platypus has a higher h-index than the quokka, this is thus consistent with the m score here.
